name: Run API Every Minute

on:
  schedule:
    - cron: '* * * * *'
  workflow_dispatch:

jobs:
  call-api:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Call API (Fastest)
        run: |
          start_time=$(date +%s)
          http_code=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET \
            -H "X-Cron-Token: ${{ secrets.CRON_TOKEN }}" \
            --max-time 30 \
            "https://networkcardahye.in/api/cron/run")
          end_time=$(date +%s)
          
          echo "✅ HTTP $http_code | Time: $((end_time - start_time))s | $(date +'%H:%M:%S')"
          
          if [ "$http_code" -ne 200 ]; then
            echo "❌ Failed: HTTP $http_code"
            exit 1
          fi
