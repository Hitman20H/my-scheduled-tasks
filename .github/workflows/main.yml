name: Run API Every Minute

on:
  schedule:
    - cron: '*/1 * * * *'
  workflow_dispatch:

jobs:
  call-api:
    runs-on: ubuntu-latest
    steps:
      - name: Display execution info
        run: |
          echo "ğŸš€ WORKFLOW TRIGGERED"
          echo "ğŸ“… Date: $(date +'%Y-%m-%d')"
          echo "â° Time: $(date +'%H:%M:%S')"
          echo "ğŸ”„ Run Number: ${{ github.run_number }}"
          echo "ğŸƒ Run Attempt: ${{ github.run_attempt }}"
          
      - name: Call API
        run: |
          echo "ğŸ“ Making API call at $(date +'%H:%M:%S')..."
          response_code=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET \
            -H "X-Cron-Token: ${{ secrets.CRON_TOKEN }}" \
            "https://networkcardahye.in/api/cron/run")
          
          echo "âœ… API Response: HTTP $response_code at $(date +'%H:%M:%S')"
          
      - name: Completion message
        run: echo "ğŸ Workflow completed at $(date +'%H:%M:%S')"
